.. _README:

======
README
======

The Mindboggle package automates shape analysis of anatomical labels
and features extracted from human brain MR image data.
Mindboggle consists of Python and C++ functions called using a Nipype
software pipeline framework for modularity, flexibility, and reproducibility
of results.

Help
====
- See below for information about Mindboggle inputs and outputs.
- `Online documentation <http://mindboggle.info/documentation.html>`_
- `Installation instructions <INSTALL.html>`_
- Help on the command line ("$" is the prompt in the terminal window)::

    $ mindboggle --help

- `License <http://mindboggle.info/users/LICENSE.html>`_
- `Background <http://mindboggle.info/faq/background.html>`_
- `Contributors <THANKS.html>`_

Mindboggle
==========

    1. combines non/cortex segmentations from FreeSurfer and ANTs software packages
    2. propagates FreeSurfer and ANTs-registered labels through cortex and noncortex voxels
    3. computes label volumes and cortical label thicknesses
    4. computes shape measures on every vertex of FreeSurfer cortical surface meshes
    5. extracts cortical surface features
    6. computes statistics on shape measures per cortical surface label/feature:

        - Surface area
        - Travel depth
        - Geodesic depth
        - Mean curvature
        - Convexity (FreeSurfer)
        - Thickness (FreeSurfer)
        - Laplace-Beltrami spectra
        - Zernike moments [UNDER EVALUATION]

Examples
========
Terminal command for processing (4 processors) multiple subjects with only FreeSurfer data::

    $ mindboggle SUBJECT1 SUBJECT2 SUBJECT3 -n 4

Example using ANTs data (with PREFIX for files in folder ~/ants_data)::

    $ mindboggle SUBJECT1 SUBJECT2 SUBJECT3 --ants_data ~/ants_output PREFIX

Example using most of the currently available options within Mindboggle::

    $ mindboggle SUBJECT1 SUBJECT2 SUBJECT3 --ants_data ~/ants_output PREFIX \
                 --sulci --fundi --vertices --spectra 10 --thickness --visual hier

Inputs
======
Mindboggle currently takes output from FreeSurfer_ (preferabley v5.3 and above)
and the latest ANTs_ software packages.

To generate FreeSurfer labeled cortical surfaces, and labeled cortical and
noncortical volumes, run ``recon-all`` on each T1-weighted IMAGE file
and set the SUBJECT name
(replace capitalized text below when typing in a terminal window;
backslashes denote line returns)::

    $ recon-all -all -s SUBJECT -i IMAGE

..
    - mri/orig/001.mgz
    - mri/aparc+aseg.mgz
    - surf/[lh,rh].pial
    - label/[lh,rh].aparc.annot

    ANTS provides brain volume extraction, segmentation, and registration-based labeling.

To generate the ANTs transforms and segmentation files used by
Mindboggle, run the antsCorticalThickness.sh script on the same
IMAGE file, set an output PREFIX, provide paths to OASIS-30 template files
(see `Installation instructions <INSTALL.html>`_), set "-k 0"
and set "-t" with the same input as "-e" (to save registration transforms).
(The -k option is a boolean to *k*eep all files produced (even temporary ones).
and the '-t' option is used to specify a target template for registration after the rest of the pipeline is finished.)::
    $ antsCorticalThickness.sh -d 3 -k 0 -n 3 -w 0.25 \
      -a IMAGE \
      -o PREFIX \
      -e OASIS-30_Atropos_template/T_template0.nii.gz \
      -t OASIS-30_Atropos_template/T_template0.nii.gz \
      -m OASIS-30_Atropos_template/T_template0_BrainCerebellumProbabilityMask.nii.gz \
      -f OASIS-30_Atropos_template/T_template0_BrainCerebellumExtractionMask.nii.gz
      -p OASIS-30_Atropos_template/Priors2/priors%d.nii.gz \

Outputs
=======
By default, all atlas and template data retrieved via the Internet
as well as Nipype workflow files are saved in $HOME/mindboggle_cache/,
and final outputs are saved in $HOME/mindboggled/
(where $HOME is the home directory).
Nifti_ image volumes (.nii.gz) store anatomical labels corresponding to the numbers
listed in the mindboggle/LABELS.py file and `online <http://mindboggle.info/data/mindboggle101/protocol.txt>`_;
all left and right cortical surface (.vtk) vertices are number-labeled
by anatomical label, feature, or shape measure. Shape measure statistics
are stored in tables (.csv).

+-+---------------+----------------------------------------------+--------------+
| |  **Folder**   | **Contents**                                 | **Format**   |
+-+---------------+----------------------------------------------+--------------+
| |   labels/     |  number-labeled surfaces and volumes         | .vtk, .nii.gz|
+-+---------------+----------------------------------------------+--------------+
| |   features/   |  surface features: folds, sulci, fundi       | .vtk         |
+-+---------------+----------------------------------------------+--------------+
| |   shapes/     |  surfaces with shape measures (per vertex)   | .vtk         |
+-+---------------+----------------------------------------------+--------------+
| |   tables/     |  tables of shape measures per label/feature  | .csv         |
+-+---------------+----------------------------------------------+--------------+

**mindboggled** / SUBJECT /

    **labels** /

        --- *Volume and surface labels* ---

        **FreeSurfer_labels** .nii.gz:  *[FreeSurfer aparc+aseg labels]*

        **FreeSurfer_filled_labels** .nii.gz:  *[non/cortex separately filled with FreeSurfer labels]*

        **ANTs_labels** .nii.gz:  *[ANTs-registered joint fusion atlas labels]*

        **ANTs_filled_labels** .nii.gz:  *[non/cortex separately filled with ANTs labels]*

        [left,right] _surface_ **FreeSurfer_cortex_labels** .vtk:  *[surface labels]*

        **ATLAS_labels** .nii.gz:  *["--atlases ATLAS_PATH" output for each ATLAS_PATH]*

    **features** /

        --- *Features extracted from cortical surface meshes* ---

        [left,right] _surface_ **folds** .vtk:  *[depth-based cortical surface folds (invaginations)]*

        [left,right] _surface_ **sulci** .vtk:  *[folds segmented into sulci using label pairs]*

        UNDER EVALUATION: [left,right] _surface_ **fundus_per_fold** .vtk:  *[curves running along depths of folds]*

        UNDER EVALUATION: [left,right] _surface_ **fundus_per_sulcus** .vtk:  *[fundus curves segmented by sulcus labels]*

    **shapes** /

        --- *Per-vertex surface shape measures* ---

        [left,right] _surface_ **area** .vtk

        [left,right] _surface_ **mean_curvature** .vtk

        [left,right] _surface_ **geodesic_depth** .vtk

        [left,right] _surface_ **travel_depth** .vtk

        [left,right] _surface_ **FreeSurfer_convexity** .vtk:  *[FreeSurfer's [lh,rh].sulc files]*

        [left,right] _surface_ **FreeSurfer_thickness** .vtk:  *[FreeSurfer's [lh,rh].thickness files]*

    **tables** /

        --- *Tables with per-label volumes and thicknesses* ---

        **FreeSurfer_filled_labels_volumes** .csv

        **FreeSurfer_filled_labels_volumes_areas_thicknesses** .csv

        **ANTs_filled_labels_volumes** .csv

        **ANTs_filled_labels_volumes_areas_thicknesses** .csv

        --- *Tables with per-label or per-feature surface shape statistics* ---

        [left,right] _surface_ **label_shapes** .csv

        [left,right] _surface_ **sulcus_shapes** .csv

        UNDER EVALUATION: [left,right] _surface_ **fundus_shapes** .csv

        --- *Table with per-vertex shape measures* ---

        [left,right] _surface_ **vertices** .csv

        **ATLAS_labels_volumes** .csv:  *["--atlases ATLAS_PATH" output for each ATLAS_PATH]*

